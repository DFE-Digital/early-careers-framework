name: Deploy

on:
  push:
    branches:
      - develop

jobs:
  deploy:
    env:
      GOVUK_NOTIFY_API_KEY: Test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1.4.4
        with:
          node-version: '12'
      - name: Yarn install
        run: npm i -g yarn && yarn
      - name: Set up Ruby
        uses: ruby/setup-ruby@9bc07a3af02ce5950e977cab8b77210dc3178328
        with:
          ruby-version: 2.7.1
      - name: Install dependencies
        run: bundle install
      - uses: citizen-of-planet-earth/cf-cli-action@master
          with:
            cf_api: https://api.london.cloud.service.gov.uk
            cf_username: ${{ secrets.CF_USER }}
            cf_password: ${{ secrets.CF_PASSWORD }}
            cf_org: dfe-ecf
            cf_space: early-careers-framework-dev
            command: push -f manifest.yml

