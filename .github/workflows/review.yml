name: Create Review App
on:
  pull_request:
    branches: [ develop ]
    types: [opened, synchronize]
    paths-ignore:
      - 'documentation/**'

jobs:
  deploy:
    runs-on: ubuntu-20.04
    steps:
      - name: setup-inputs
        run: |
          INPUTS='${{ format('{{"environment": "review-pr-{0}", "ref": "{1}"}}',  github.event.number, github.sha) }}'
          echo "INPUTS=${INPUTS}" >> $GITHUB_ENV

      - name: trigger-deploy
        uses: benc-uk/workflow-dispatch@v1.1
        with:
          workflow: Deploy to Environment # Workflow name, in deploy.yml
          token: ${{ secrets.PERSONAL_TOKEN }}
          inputs: ${{ env.INPUTS }}
          ref: ${{ github.event.pull_request.head.ref }}

  example:
    name: sample comment
    runs-on: ubuntu-latest
    steps:
      - name: comment PR
        uses: unsplash/comment-on-pr@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          msg: "Creating review app at https://ecf-review-pr-${{ github.event.number }}.london.cloudapps.digital"
