<% content_for :title, t("finance.ecf.payment_breakdown") %>
<% content_for :before_content, govuk_back_link(text: "Back", href: select_provider_ecf_finance_payment_breakdowns_path) %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column">
    <ul class="govuk-list">
      <li><%= text_otherwise_link_to("Payable", payable_finance_ecf_payment_breakdown_path, controller.action_name == "payable") %></li>
      <li><%= text_otherwise_link_to("Current", finance_ecf_payment_breakdown_path, controller.action_name == "show") %></li>
    </ul>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column">
    <h1 class="govuk-heading-xl"><%= @ecf_lead_provider.name %></h1>
    <p class="govuk-caption-m govuk-!-margin-0">Payment of</p>
    <h2 class="govuk-heading-xl govuk-!-margin-0"><%= number_to_pounds(total_payment_combined(breakdown_started: @breakdown_started, breakdown_retained_1: @breakdown_retained_1, ecf_lead_provider: @ecf_lead_provider)) %></h2>
    <p class="govuk-caption-m govuk-!-margin-top-0">On <%= @statement.payment_date.to_s(:govuk) %></p>

    <%= render Finance::ECF::BreakdownSummary.new(breakdown_started: @breakdown_started, breakdown_retained_1: @breakdown_retained_1, lead_provider: @ecf_lead_provider, deadline_date: @statement.deadline_date) %>
    <%= render Finance::ECF::OutputPayments.new(output_payments: @breakdown_started[:output_payments], breakdown_summary: @breakdown_started[:breakdown_summary]) %>
    <%= render Finance::ECF::ServiceFees.new(service_fees: @breakdown_started[:service_fees], breakdown_summary: @breakdown_started[:breakdown_summary]) %>

    <%= govuk_accordion do |accordion| %>
      <% if @breakdown_started[:other_fees] %>
        <% @breakdown_started[:other_fees].each do |other_fee| %>
          <%= accordion.section heading_text: "#{Finance::ECF::OtherFee.new(other_fee).name.capitalize} fee" do %>
            <%= render Finance::ECF::OtherFeeRow.new(other_fee: Finance::ECF::OtherFee.new(other_fee)) %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

    <%= render Finance::ECF::OutputPayments.new(output_payments: @breakdown_retained_1[:output_payments], breakdown_summary: @breakdown_retained_1[:breakdown_summary]) %>
    <%= render Finance::ECF::ServiceFees.new(service_fees: @breakdown_retained_1[:service_fees], breakdown_summary: @breakdown_retained_1[:breakdown_summary]) %>

    <%= govuk_accordion do |accordion| %>
      <% if @breakdown_retained_1[:other_fees] %>
        <% @breakdown_retained_1[:other_fees].each do |other_fee| %>
          <%= accordion.section heading_text: "#{Finance::ECF::OtherFee.new(other_fee).name.capitalize} fee" do %>
            <%= render Finance::ECF::OtherFeeRow.new(other_fee: Finance::ECF::OtherFee.new(other_fee)) %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>

<%= govuk_link_to t("finance.show_contract"), finance_ecf_contract_path(id: @ecf_lead_provider.id) %>
