<% content_for :title, "Early career teachers and mentors" %>

<% content_for :before_content, govuk_back_link(text: "Back", href: schools_dashboard_path) %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <span class="govuk-caption-xl"><%= @school.name %></span>
    <h1 class="govuk-heading-xl">Manage mentors and ECTs</h1>

    <div class="wrapper-dashboard-v2 manage-mentors-ects">
      <%= govuk_button_link_to(
            "Add ECT or mentor",
            start_schools_who_to_add_participants_path(cohort_id: @school.school_cohorts.dashboard_cohorts.first.start_year),
            class: "govuk-link--no-visited-state",
          ) %>

      <% if actions?(@participants) %>
        <% if @participants.orphan_ects.any? %>
          <%= govuk_warning_text(text: "You need to assign a mentor to these ECTs.") %>
          <ul class="govuk-list">
            <% @participants.orphan_ects.sort_by(&:participant_full_name).each do |ect| %>
              <li>
                <%= govuk_link_to(ect.participant_full_name, schools_participant_path(id: ect.participant_profile_id,
                                                                                      school_id: @school),
                                  no_visited_state: true,
                                  classes: ["govuk-\!-padding-bottom-static-1 govuk-\!-margin-bottom-static-0"]) %>
              </li>
            <% end %>
          </ul>
          <br>
        <% end %>
      <% end %>

      <% @participants.mentors.keys.sort_by(&:participant_full_name).each do |mentor| %>
        <div class="group-card">
          <%= govuk_summary_list(actions: false, borders: nil) do |list| %>
            <% list.row do |row| %>
              <% row.key(text: "Mentor") %>
            <% end %>

            <% list.row do |row| %>
              <% row.key(text: govuk_link_to(mentor.participant_full_name,
                                             schools_participant_path(id: mentor.participant_profile_id,
                                                                      school_id: @school),
                                             no_visited_state: true),
                         classes: ["govuk-!-font-weight-regular"]) %>
              <% row.value(text: render(ParticipantStatusTagComponent.new(profile: mentor.participant_profile,
                                                                          induction_record: mentor,
                                                                          has_mentees: true))) %>
            <% end %>

            <% list.row do |row| %>
              <% row.key(text: "ECTs") %>
            <% end %>

            <% @participants.mentors[mentor].sort_by(&:participant_full_name).each do |ect| %>
              <% list.row do |row| %>
                <% row.key(text: govuk_link_to("#{ect.participant_full_name}",
                                               schools_participant_path(id: ect.participant_profile_id,
                                                                        school_id: @school),
                                               no_visited_state: true),
                           classes: ["govuk-!-font-weight-regular", "govuk-\!-padding-bottom-static-0"]) %>
                <% row.value(text: render(ParticipantStatusTagComponent.new(profile: ect.participant_profile,
                                                                            induction_record: ect)),
                             classes: ["govuk-\!-padding-bottom-static-0"]) %>
              <% end %>
            <% end %>
          <% end %>
        </div>
        <br>
      <% end %>

      <% if @participants.orphan_mentors.any? %>
        <%= govuk_summary_list(actions: false, borders: nil) do |list| %>
          <% list.row do |row| %>
            <% row.key(text: @participants.orphan_mentors.many? ? "Mentors" : "Mentor") %>
          <% end %>

          <% @participants.orphan_mentors.sort_by(&:participant_full_name).each do |mentor| %>
            <% list.row do |row| %>
              <% row.key(text: govuk_link_to(mentor.participant_full_name,
                                             schools_participant_path(id: mentor.participant_profile_id,
                                                                      school_id: @school),
                                             no_visited_state: true),
                         classes: ["govuk-!-font-weight-regular", "govuk-\!-padding-bottom-static-0"]) %>
              <% row.value(text: render(ParticipantStatusTagComponent.new(profile: mentor.participant_profile,
                                                                          induction_record: mentor)),
                           classes: ["govuk-\!-padding-bottom-static-0"]) %>
            <% end %>
          <% end %>
        <% end %>
    <% end %>
    </div>
  </div>
</div>
