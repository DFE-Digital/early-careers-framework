<% content_for :title, "Manage training" %>

<% if breadcrumbs.any? %>
  <% content_for :before_content, govuk_breadcrumbs(breadcrumbs: breadcrumbs) %>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <span class="govuk-caption-xl"><%= @school.name %></span>
    <h1 class="govuk-heading-xl">Manage your training</h1>

    <div class="wrapper-dashboard-v2">
      <%= govuk_button_link_to "Manage mentors and ECTs", school_participants_path %>

      <h2 class="govuk-heading-m">Participant summary</h2>
      <%= govuk_summary_list do |list| %>
        <% list.row do |row| %>
          <% row.key(text: "Induction tutor") %>
          <% row.value(text: @school.induction_coordinators.first.full_name) %>
          <% row.action(text: "Change", href: name_schools_change_sit_path, visually_hidden_text: "induction tutor") %>
        <% end %>

        <% if manage_ects_and_mentors?(@school_cohorts) %>
          <% list.row do |row| %>
            <% row.key(text: "Mentors") %>
            <% row.value(text: mentor_count(@school_cohorts)) %>
            <% row.action(text: :none) %>
          <% end %>

          <% list.row do |row| %>
            <% row.key(text: "ECTs") %>
            <% row.value(text: ect_count(@school_cohorts)) %>
            <% row.action(text: :none) %>
          <% end %>

          <% list.row do |row| %>
            <% row.key(text: "ECTs without mentors") %>
            <% row.value(text: ect_with_no_mentor_count(@school_cohorts)) %>
            <% row.action(text: :none) %>
          <% end %>
        <% end %>
      <% end %>

      <br>
      <h2 class="govuk-heading-m">Academic year</h2>
      <%= govuk_tabs(title: "Cohorts") do |component| %>
        <% if set_up_new_cohort? %>
          <% component.tab(label: TabLabelDecorator.new(Cohort.active_registration_cohort.description)) do %>
            <%= render partial: "setup_school_cohort" %>
          <% end %>
        <% end %>
        <% @school_cohorts.each do |school_cohort| %>
          <% component.tab(label: TabLabelDecorator.new(school_cohort.description)) do %>
            <% if school_cohort.induction_programme_choice == "no_early_career_teachers" %>
              <%= render partial: "no_ects_cohort_details", locals: { school_cohort: school_cohort } %>
            <% else %>
              <%= render partial: "school_cohort_details", locals: { school_cohort: school_cohort } %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
