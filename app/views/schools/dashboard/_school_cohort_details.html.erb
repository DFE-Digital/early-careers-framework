<% lead_provider = school_cohort.default_induction_programme&.lead_provider %>
<% delivery_partner =  school_cohort.default_induction_programme&.delivery_partner %>
<% ects_count = school_cohort.current_induction_records.count %>
<% partnership = school_cohort.school.partnerships.active.find_by(cohort: school_cohort.cohort) %>

<% if school_cohort.school_chose_cip? && school_cohort.default_induction_programme&.core_induction_programme.blank? %>
<div class="govuk-body">
  <h2 class="govuk-heading-m">Choose your training materials</h2>
  <p><%= govuk_link_to "Tell us which materials will you use", info_schools_core_programme_materials_path(cohort_id: school_cohort.cohort.start_year) %></p>
  <p>Read our guidance to <%= govuk_link_to 'compare materials (opens in new tab)', page_path(page: "core-materials-info"), target: "_blank" %>.</p>
</div>
<% end %>

<%= govuk_summary_list do |list| %>
  <% list.row do |row| %>
    <% row.key(text: "Length of induction") %>
    <% row.value(text: "2") %>
    <% row.action(text: :none) %>
  <% end %>
  <% unless school_cohort.school_chose_diy? %>
    <% list.row do |row| %>
      <% row.key(text: "ECTs and mentors") %>
      <% row.value(text: ects_count) %>
      <% row.action(text: ects_count.zero? ? "Add" : "Manage", href: schools_participants_path(cohort_id: school_cohort.cohort.start_year)) %>
    <% end %>
  <% end %>
  <% list.row do |row| %>
    <% row.key(text: "Induction tutor") %>
    <% row.value(text: school_cohort.school.induction_coordinators.first.full_name) %>
    <% row.action(text: "Change", href: name_schools_change_sit_path, visually_hidden_text: "induction tutor") %>
  <% end %>
  <% list.row do |row| %>
    <% row.key(text: "Programme") %>
    <% row.value(text: t(school_cohort.induction_programme_choice, scope: %i[manage_your_training induction_programmes])) %>
    <% row.action(text: "Change", href: change_programme_schools_cohort_path(cohort_id: school_cohort.cohort.start_year), visually_hidden_text: "induction programme choice") %>
  <% end %>
  <% if school_cohort.full_induction_programme? %>
    <% list.row do |row| %>
      <% row.key(text: "Training provider") %>
      <% row.value(text: lead_provider&.name ? lead_provider.name : "To be confirmed") %>
      <% row.action(text: :none) %>
    <% end %>
    <% list.row do |row| %>
      <% row.key(text: "Delivery partner") %>
      <% row.value(text: delivery_partner&.name ? delivery_partner.name : "To be confirmed") %>
      <% row.action(text: :none) %>
    <% end %>
  <% elsif school_cohort.core_induction_programme? %>
    <% list.row do |row| %>
      <% row.key(text: "Materials") %>
      <% row.value(text: school_cohort.default_induction_programme&.core_induction_programme&.name) %>
      <% if school_cohort.default_induction_programme&.core_induction_programme.blank? %>
        <% row.action(text: "Choose", href: info_schools_core_programme_materials_path(cohort_id: school_cohort.cohort.start_year), visually_hidden_text: "materials") %>
      <% else %>
        <% row.action(text: "Change", href: schools_core_programme_materials_path(cohort_id: school_cohort.cohort.start_year), visually_hidden_text: "materials") %>
      <% end %>
    <% end %>
  <% end %>
<% end %>


<% if partnership %>
  <% if partnership&.in_challenge_window? %>
    <p class="govuk-body">
      If this does not look right, <%= govuk_link_to "report that your school has been confirmed incorrectly", challenge_partnership_path(partnership: partnership) %>. This link will expire on <%= partnership.challenge_deadline&.strftime("%d/%m/%Y") %>.
    </p>
  <% else %>
    <p class="govuk-body">
    If this does not look right, contact: <%= render MailToSupportComponent.new %>
    </p>
  <% end %>
<% end %>
