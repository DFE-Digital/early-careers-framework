<%=
  admin_participant_header_and_title(
    profile: @participant_profile,
    section: "Training record states"
  )
%>

<%= render partial: "admin/participants/nav" %>

<% states = DetermineTrainingRecordState.call(participant_profile: @participant_profile, school: @participant_presenter.school) %>

<h2 class="govuk-heading-m">School</h2>
<% if @participant_presenter.school.blank? %>
  <p>No school details for <%= @participant_presenter.full_name %>.</p>
<% else %>
  <%= govuk_summary_list(actions: true) do |sl|
    sl.row do |row|
      row.key(text: "Name")
      row.value do
        govuk_link_to(
          @participant_presenter.school_name,
          admin_school_path(@participant_presenter.school_friendly_id)
        )
      end
    end

    sl.row do |row|
      row.key(text: "Training record")
      row.value(text: render(StatusTags::SchoolParticipantStatusTag.new(participant_profile: @participant_presenter.participant_profile, school: @participant_presenter.school)))
    end

    sl.row do |row|
      row.key(text: "Validation status")
      row.value(text: states.validation_state)
    end

    sl.row do |row|
      row.key(text: "Training eligibility status")
      row.value(text: states.training_eligibility_state)
    end

    sl.row do |row|
      row.key(text: "FIP funding eligibility status")
      row.value(text: states.fip_funding_eligibility_state)
    end

    sl.row do |row|
      row.key(text: "Training status")
      row.value(text: states.training_state)
    end
  end %>
<% end %>

<h2 class="govuk-heading-m">Lead provider</h2>
<% if @participant_presenter.lead_provider_name.blank? %>
  <p>No lead provider details for <%= @participant_presenter.full_name %>.</p>
<% else %>
  <%= govuk_summary_list(actions: true) do |sl|
    sl.row do |row|
      row.key(text: "Name")
      row.value(text: @participant_presenter.lead_provider_name)
    end

    sl.row do |row|
      row.key(text: "Training record state")
      row.value(text: @participant_presenter.relevant_induction_record&.training_status)
    end
  end %>
<% end %>

<h2 class="govuk-heading-m">Delivery partner</h2>
<% if @participant_presenter.delivery_partner_name.blank? %>
  <p>No delivery partner details for <%= @participant_presenter.full_name %>.</p>
<% else %>
  <%= govuk_summary_list(actions: true) do |sl|
    sl.row do |row|
      row.key(text: "Name")
      row.value(text: @participant_presenter.delivery_partner_name)
    end

    sl.row do |row|
      row.key(text: "Training record state")
      row.value(text: render(StatusTags::DeliveryPartnerParticipantStatusTag.new(participant_profile: @participant_presenter.participant_profile, delivery_partner: @participant_presenter.school_cohort&.delivery_partner)))
    end
  end %>
<% end %>

<h2 class="govuk-heading-m">Appropriate body</h2>
<% if @participant_presenter.appropriate_body_name.blank? %>
  <p>No delivery partner details for <%= @participant_presenter.full_name %>.</p>
<% else %>
  <%= govuk_summary_list(actions: true) do |sl|
    sl.row do |row|
      row.key(text: "Name")
      row.value(text: @participant_presenter.appropriate_body_name)
    end

    sl.row do |row|
      row.key(text: "Training record state")
      row.value(text: render(StatusTags::AppropriateBodyParticipantStatusTag.new(participant_profile: @participant_presenter.participant_profile, induction_record: @participant_presenter.relevant_induction_record)))
    end
  end %>
<% end %>
