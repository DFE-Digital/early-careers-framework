<%= render "admin/npq/applications/layout", locals = { page: "applications" } %>

<div class="admin-search-box">
  <%= form_with method: :get do |f| %>
    <%= f.govuk_text_field(
        :query,
        value: params[:query],
        label: { text: "Search Applicants", size: "m" },
        hint: { text: "Enter the Applicantâ€™s ID, Name, Email, Employer's Name, TRN or Application Id", size: "s" },
      )
    %>

    <%= f.govuk_submit "Search" %>
  <% end %>
</div>

<%=
  govuk_table do |table|
    table.head do |head|
      head.row do |row|
        row.cell(header: true, text: "Name")
        row.cell(header: true, text: "Eligible for funding")
        row.cell(header: true, text: "Funding eligibility status code")
        row.cell(header: true, text: "Employment type")
        row.cell(header: true, text: "Employer name")
        row.cell(header: true, text: "Role")
        row.cell(header: true, text: "Created at")
      end
    end 

    table.body do |body|
      @npq_applications.each do |application|
        body.row do |row|
          row.cell(text: govuk_link_to(application.user.full_name, admin_npq_applications_edge_case_path(application)))
          row.cell(text: boolean_red_green_tag(application.eligible_for_funding))
          row.cell(text: application.funding_eligiblity_status_code&.humanize&.downcase)
          row.cell(text: application.employment_type&.humanize || '-')
          row.cell(text: application.employer_name || '-')
          row.cell(text: application.employment_role&.humanize&.downcase || '-')
          row.cell(text: application.created_at.to_s(:govuk_short))
        end
      end
    end
  end
%>

<%= govuk_pagination(pagy: @pagy) %>
